# NFR.md — Таблица требований безопасности

| ID     | Название                        | Описание                                                         | Метрика/Порог                                                        | Проверка (чем/где)               | Компонент     | Приоритет |
|--------|---------------------------------|------------------------------------------------------------------|----------------------------------------------------------------------|----------------------------------|---------------|-----------|
| NFR-01 | Хранение паролей                | Хэширование паролей только `Argon2id` с современными параметрами | t=3, m=256MB, p=1                                                    | Unit-тесты                       | auth          | High      |
| NFR-02 | JWT секрет и ротация            | `SECRET_KEY` обязателен из окружения; ротация секрета            | Ротация ≤ 90 дней; fail-fast при отсутствии                          | CI Secret-policy                 | auth/platform | High      |
| NFR-03 | TTL access-token                | Срок жизни access-токена ограничен                               | `exp` ≤ 60 мин                                                       | Unit-тесты                       | auth          | Medium    |
| NFR-04 | Формат ошибок                   | Единый JSON-конверт, без утечки PII                              | 100% эндпоинтов                                                      | Контракт-тесты                   | api           | Medium    |
| NFR-05 | CORS политика                   | Разрешены только доверенные origins; без `credentials` с `*`     | Список ORIGINS в `.env`; `credentials=false`                         | Конфиг `app/main.py`             | api           | High      |
| NFR-06 | Rate limiting                   | Ограничение частоты на POST-запросы                              | ≤ 10 req/min/IP                                                      | Нагрузочные тесты                | api/platform  | High      |
| NFR-07 | Контроль владения               | Доступ к `PUT/DELETE /api/ideas/{id}` только владельцу           | 100% запросов проверяют owner                                        | Unit-тесты                       | api           | High      |
| NFR-08 | Скан зависимостей               | High/Critical уязвимости устраняются оперативно                  | Время устранения ≤ 7 дней                                            | CI                               | build         | High      |
| NFR-09 | Secrets scanning                | Нет hardcoded секретов                                           | 0 найденных секретов                                                 | CI                               | build         | High      |
| NFR-10 | Контейнерная безопасность       | runtime без dev-зависимостей                                     | 0 dev deps в runtime                                                 | Контейнерные тесты               | container     | Medium    |
| NFR-11 | Аудит событий                   | Логирование входа/выхода, CRUD                                   | Покрытие ≥ 95%; ретенция 90 дней                                     | Интеграционные тесты             | api/platform  | Medium    |
| NFR-12 | OpenAPI в prod                  | Документация отключена или за базовой аутентификацией в prod     | `/docs` закрыт в prod                                                | Конфиг FastAPI (`docs_url=None`) | api/platform  | Low       |
| NFR-13 | Производительность ключевых API | Порог `p95` для основных эндпоинтов                              | `/api/token` p95 ≤ 300ms @ 50 RPS; `/api/ideas` p95 ≤ 200ms @ 50 RPS | Нагрузочные тесты                | api/auth      | Medium    |
